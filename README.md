# Rent-It Backend Service

This repository contains the backend source code for the "Rent-It" application. It is a robust RESTful API built with Java and the Spring Boot framework, designed to handle user authentication, property listings, and data management for a rental platform.

## Table of Contents
1.  [Overview](#overview)
2.  [Key Features](#key-features)
3.  [Technologies Used](#technologies-used)
4.  [Project Structure](#project-structure)
5.  [Prerequisites](#prerequisites)
6.  [Setup and Configuration](#setup-and-configuration)
7.  [Running the Application](#running-the-application)
8.  [API Endpoint Specifications](#api-endpoint-specifications)

## Overview

The Rent-It backend provides a complete set of services for a property rental application. It manages users, handles secure authentication via both traditional email/password and Google OAuth2, and exposes endpoints for creating, reading, updating, and deleting (CRUD) property listings. It is designed to be a secure, scalable, and maintainable foundation for a modern web application.

## Key Features

*   **User Authentication**: Secure user signup and login using JWT (JSON Web Tokens).
*   **OAuth2 Integration**: Allows users to sign in or sign up using their Google accounts.
*   **User Profile Management**: Endpoints to create, read, update, and delete user profiles.
*   **Property Listings**: Full CRUD functionality for rental properties.
*   **Advanced Filtering**: Filter properties by location (country, state, city), type, and price range.
*   **Centralized Configuration**: Unified handling of security, CORS, and application settings.
*   **Global Exception Handling**: Graceful error handling for a better developer and user experience.

## Technologies Used

*   **Language**: Java 17+
*   **Framework**: Spring Boot 3.x
*   **Security**: Spring Security (JWT, OAuth2 Client, Password Encoding)
*   **Data Persistence**: Spring Data JPA / Hibernate
*   **Database**: Designed for a relational database like PostgreSQL or MySQL.
*   **API**: Spring Web (REST controllers)
*   **Authentication**: JSON Web Tokens (JWT) via the `io.jsonwebtoken` library.
*   **Validation**: Jakarta Bean Validation for request data integrity.
*   **Boilerplate Reduction**: Lombok
*   **Build Tool**: Maven or Gradle

## Project Structure

The project follows a standard feature-driven package structure to ensure clean separation of concerns.

```
com.google.rentit
├── RentitApplication.java      # Main Spring Boot application class
│
├── auth                        # Authentication-related code
│   ├── controller              # AuthController, OAuthController
│   └── service                 # AuthService
│
├── common
│   └── enums                   # Reusable enums (PropertyType, Role, etc.)
│
├── config                      # Central configuration files
│   ├── CorsConfig.java         # Global CORS settings
│   ├── JwtService.java         # JWT generation and validation
│   └── SecurityConfig.java     # Spring Security filter chains and rules
│
├── exception                   # Global exception handling
│   ├── GlobalExceptionHandler.java
│   └── ResourceNotFoundException.java
│
├── property                    # Feature package for Properties
│   ├── controller
│   ├── dto                     # Data Transfer Objects for properties
│   ├── model
│   ├── repository
│   └── service
│
└── user                        # Feature package for Users
    ├── controller
    ├── dto
    ├── model
    ├── repository
    └── service
```
## 8. Database Schema Details

The Rent-It backend interacts with a PostgreSQL database, managing two primary entities: **Users** and **Properties**. Below are the detailed schemas for these tables.

### `users` Table

This table stores all user-related information, including authentication credentials and profile details.

| Column            | Type                      | Nullable | Default                        | Description                                     |
| :---------------- | :------------------------ | :------- | :----------------------------- | :---------------------------------------------- |
| `id`              | `bigint`                  | `NOT NULL` | `generated by default as identity` | Primary key, unique user identifier.            |
| `user_name`       | `character varying(100)`  | `NOT NULL` |                                | Display name of the user.                       |
| `google_email`    | `character varying(255)`  | `NOT NULL` |                                | Unique email, used for login and Google OAuth.  |
| `password`        | `character varying(255)`  | `NOT NULL` |                                | Hashed password for traditional login.          |
| `gender`          | `character varying(255)`  | `NOT NULL` |                                | User's gender.                                  |
| `bio`             | `text`                    |          |                                | Short biography of the user.                    |
| `living_habits`   | `character varying(255)`  |          |                                | User's living preferences/habits.               |
| `interests`       | `character varying(255)`  |          |                                | User's hobbies or interests.                    |
| `phone_number`    | `character varying(255)`  |          |                                | User's contact phone number.                    |

**Indexes & Constraints:**
* `users_pkey`: Primary Key on `id`.
* `users_google_email_key`: Unique constraint on `google_email` to ensure no duplicate email registrations.

**Referenced By:**
* `property` table (via `renter_user_id` foreign key).

### `property` Table

This table holds all details related to property listings available on the Rent-It platform.

| Column                     | Type                           | Nullable | Default                            | Description                                                 |
| :------------------------- | :----------------------------- | :------- | :--------------------------------- | :---------------------------------------------------------- |
| `id`                       | `bigint`                       | `NOT NULL` | `generated by default as identity`   | Primary key, unique property identifier.                    |
| `renter_user_id`            | `bigint`                       | `NOT NULL` |                                    | Foreign key referencing `users.id` of the property renter.   |
| `title`                    | `character varying(255)`       | `NOT NULL` |                                    | Title of the property listing.                              |
| `description`              | `text`                         | `NOT NULL` |                                    | Detailed description of the property.                       |
| `address`                  | `character varying(500)`       | `NOT NULL` |                                    | Full street address of the property.                        |
| `city`                     | `character varying(100)`       | `NOT NULL` |                                    | City where the property is located.                         |
| `state`                    | `character varying(100)`       | `NOT NULL` |                                    | State where the property is located.                        |
| `country`                  | `character varying(100)`       | `NOT NULL` |                                    | Country where the property is located.                      |
| `rent_monthly`             | `double precision`             | `NOT NULL` |                                    | Monthly rental cost.                                        |
| `number_of_bedrooms`       | `integer`                      | `NOT NULL` |                                    | Number of bedrooms in the property.                         |
| `number_of_bathrooms`      | `integer`                      | `NOT NULL` |                                    | Number of bathrooms in the property.                        |
| `amenities`                | `character varying(255)`       |          |                                    | Comma-separated list or JSON string of available amenities. |
| `availability_start_date`  | `timestamp(6) without time zone` | `NOT NULL` |                                    | Date from which the property is available.                  |
| `is_available_for_flatmates` | `boolean`                      | `NOT NULL` |                                    | Indicates if the property can be rented by flatmates.       |
| `is_available_for_rent`    | `boolean`                      | `NOT NULL` |                                    | Indicates if the entire property is available for rent.     |
| `listing_type`             | `character varying(255)`       | `NOT NULL` |                                    | Type of listing (e.g., 'ENTIRE_PLACE', 'PRIVATE_ROOM', 'SHARED_PLACE'). |
| `looking_for`              | `character varying(255)`       | `NOT NULL` |                                    | Preferred tenant gender for shared places (e.g., 'MALE', 'FEMALE', 'NON_BINARY', 'ANY'). |
| `type`                     | `character varying(255)`       | `NOT NULL` |                                    | Type of property (e.g., 'APARTMENT', 'ROOM', 'PG').       |

**Indexes & Constraints:**
* `property_pkey`: Primary Key on `id`.
* `property_listing_type_check`: Check constraint ensuring `listing_type` is one of `ENTIRE_PLACE`, `PRIVATE_ROOM`, `SHARED_PLACE`.
* `property_looking_for_check`: Check constraint ensuring `looking_for` is one of `MALE`, `FEMALE`, `NON_BINARY`, `ANY`.
* `property_type_check`: Check constraint ensuring `type` is one of `APARTMENT`, `ROOM`, `PG`.
* `fkgkwlpjqkba3ussimxgigcwukd`: Foreign Key constraint linking `renter_user_id` to `users.id`.

---

## Prerequisites

Before you begin, ensure you have the following installed:
*   **JDK 17** or newer.
*   **Maven** or **Gradle**.
*   A running instance of a relational database (e.g., **PostgreSQL**, **MySQL**).
*   **Google OAuth2 Credentials** (Client ID and Client Secret) from the Google Cloud Console.

## Setup and Configuration

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/anushkaisnotlazy/RentIt.git
    cd RentIt
    ```

2.  **Configure the application:**
    Open the `src/main/resources/application.properties` (or `application.yml`) file. You will need to add configuration for your database and Google OAuth2 credentials.

    **Example `application.properties`:**
    ```properties
    # Database Configuration (Example for PostgreSQL)
    spring.datasource.url=jdbc:postgresql://localhost:5432/rentit_db
    spring.datasource.username=your_db_user
    spring.datasource.password=your_db_password
    spring.jpa.hibernate.ddl-auto=update
    spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

    # Google OAuth2 Client Configuration
    spring.security.oauth2.client.registration.google.client-id=YOUR_GOOGLE_CLIENT_ID
    spring.security.oauth2.client.registration.google.client-secret=YOUR_GOOGLE_CLIENT_SECRET
    spring.security.oauth2.client.registration.google.scope=profile,email
    spring.security.oauth2.client.registration.google.redirect-uri=http://localhost:8080/api/auth/oauth/callback
    ```

## Running the Application

You can run the application using your IDE (like IntelliJ or VS Code) or from the command line.

**Using Maven:**
```bash
# Build the project
mvn clean install

# Run the application
mvn spring-boot:run
```
The server will start on `http://localhost:3456` by default.

## API Endpoint Specifications

Here is a summary of the primary API endpoints.

#### Authentication (`/api/auth`)
*   `POST api/auth/signup`: Registers a new user with email, password, and profile details.
*   `POST api/auth/login`: Authenticates a user and returns a JWT access token and a refresh token in an HttpOnly cookie.
*   `GET /oauth/callback`: The redirect URI for the Google OAuth2 flow. It handles user creation/login and redirects to the frontend with a JWT.

#### OAuth Flow (`/`)
*   `GET /oauth2/authorize/google`: Initiates the Google OAuth2 login flow by redirecting the user to Google's consent screen.

#### User Management (`/users`)
*   `GET /{id}`: Retrieves the public profile of a user by their ID.
*   `POST /createprofile`: Creates a new user profile (alternative to `/signup`).
*   `PUT /{id}`: Updates the profile information for a given user.
*   `DELETE /{id}`: Deletes a user account.

#### Property Management (`/properties`)
*   `GET /all`: Retrieves a list of all properties.
*   `POST /add`: Creates a new property listing.
*   `PUT /add/{id}`: Updates an existing property listing by its ID.
*   `GET /filter`: Filters properties based on query parameters.
    *   **Query Params**: `country`, `state`, `city`, `propertyType`, `minPrice`, `maxPrice`.
    *   **Example**: `/properties/filter?city=New York&maxPrice=3000`
